<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fake Job Detection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-100 to-indigo-200 min-h-screen flex items-center justify-center">
    <div class="max-w-6xl w-full mx-auto p-8 space-y-6 bg-white shadow-xl rounded-lg">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-indigo-700">AI Fake Job Detection</h1>
            <p class="text-gray-600">Enter job listing details to analyze potential fraud indicators.</p>
        </div>
        
        <!-- Job Input Form -->
        <div class="grid grid-cols-2 gap-6">
            <div>
                <label class="block font-medium">Job Title</label>
                <input type="text" id="title" class="w-full p-3 border rounded shadow-sm">
            </div>
            <div>
                <label class="block font-medium">Company Name</label>
                <input type="text" id="company" class="w-full p-3 border rounded shadow-sm">
            </div>
            <div class="col-span-2">
                <label class="block font-medium">Job Description</label>
                <textarea id="description" class="w-full p-3 border rounded shadow-sm" rows="3"></textarea>
            </div>
            <div>
                <label class="block font-medium">Salary</label>
                <input type="number" id="salary" class="w-full p-3 border rounded shadow-sm">
            </div>
            <div>
                <label class="block font-medium">Contact Email</label>
                <input type="email" id="email" class="w-full p-3 border rounded shadow-sm">
            </div>
            <div class="col-span-2">
                <label class="block font-medium">Job Requirements</label>
                <textarea id="requirements" class="w-full p-3 border rounded shadow-sm" rows="3"></textarea>
            </div>
        </div>
        
        <button id="analyzeBtn" class="w-full bg-indigo-600 text-white p-3 rounded hover:bg-indigo-700 flex items-center justify-center">
            <span>Analyze Job Listing</span>
            <span id="loading" class="ml-2 hidden animate-spin">⏳</span>
        </button>

        <!-- Analysis Results -->
        <div id="analysisResults" class="bg-gray-100 p-6 rounded-lg hidden">
            <h2 class="text-xl font-bold flex items-center gap-2">
                Analysis Results <span id="riskIcon"></span>
            </h2>
            <p id="timestamp" class="text-gray-600"></p>
            <div id="alertContainer" class="p-4 rounded mt-4">
                <h3 id="riskLevel" class="font-bold"></h3>
                <ul id="risksList" class="list-disc pl-4"></ul>
            </div>
            <p class="text-sm text-gray-500">Note: This is an automated analysis with realtime updated database.</p>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#analyzeBtn').click(function() {
                $('#loading').removeClass('hidden');
                
                const jobDetails = {
                    title: $('#title').val(),
                    company: $('#company').val(),
                    description: $('#description').val(),
                    salary: $('#salary').val(),
                    email: $('#email').val(),
                    requirements: $('#requirements').val()
                };

                $.ajax({
                    url: '/analyze',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(jobDetails),
                    success: function(response) {
                        $('#loading').addClass('hidden');
                        
                        // Access the nested data object from the response
                        const analysis = response.data;
                        
                        $('#timestamp').text('Analysis completed at ' + analysis.timestamp);
                        $('#riskLevel').text('Risk Level: ' + analysis.risk_level.toUpperCase());
                        
                        const riskColors = {
                            'high': 'text-red-600 bg-red-100',
                            'medium': 'text-yellow-600 bg-yellow-100',
                            'low': 'text-green-600 bg-green-100'
                        };
                        $('#alertContainer').attr('class', `p-4 rounded mt-4 ${riskColors[analysis.risk_level]}`);
                        
                        const riskIcons = {
                            'high': '⚠️⚠️',
                            'medium': '⚠️',
                            'low': '✅'
                        };
                        $('#riskIcon').html(`<span>${riskIcons[analysis.risk_level]}</span>`);
                        
                        $('#risksList').empty();
                        if (analysis.risks.length > 0) {
                            analysis.risks.forEach(risk => {
                                $('#risksList').append(`<li>${risk}</li>`);
                            });
                        } else {
                            $('#risksList').append('<li>No risk indicators detected. This job listing appears legitimate.</li>');
                        }
                        
                        $('#analysisResults').removeClass('hidden');
                        
                        // Scroll to the analysis results with smooth animation
                        $('html, body').animate({
                            scrollTop: $('#analysisResults').offset().top
                        }, 800);
                    },
                    error: function(xhr) {
                        $('#loading').addClass('hidden');
                        if (xhr.responseJSON && xhr.responseJSON.errors) {
                            alert('Validation errors: ' + xhr.responseJSON.errors.join('\n'));
                        } else {
                            alert('An error occurred while analyzing the job listing.');
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>